<ion-header>
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button defaultHref="tabs/(map:map)"></ion-back-button>
        </ion-buttons>
        <ion-title>
            Route
        </ion-title>
    </ion-toolbar>
</ion-header>
<ion-content [formGroup]="this.navigationService.routeForm" scrollEvents="true">
    <ion-list style="height: 100%">
        <ion-toolbar class="search">
            <ion-icon [hidden]="this.navigationService.autocompleteStartPoint.input !== 'Mein Standort'" slot="start"
                      name="radio-button-on"></ion-icon>
            <ion-icon [hidden]="this.navigationService.autocompleteStartPoint.input === 'Mein Standort'" slot="start"
                      name="radio-button-off"></ion-icon>
            <ion-input type="text" [(ngModel)]="this.navigationService.autocompleteStartPoint.input"
                       (ionInput)="this.navigationService.updateSearchResults(this.navigationService.autocompleteStartPoint)"
                       (ionFocus)="this.navigationService.showItemsStartPoint = true;
                               this.navigationService.showItemsWayPoint = false;
                               this.navigationService.showItemsEndPoint = false;
                               this.navigationService.showItemsPlaceSearch = false;
                               this.navigationService.autocompleteItems = [];"
                       placeholder="Startpunkt" formControlName="start_point">
            </ion-input>
            <ion-buttons slot="end" [hidden]="this.navigationService.autocompleteStartPoint.input < 1">
                <ion-button (click)="this.navigationService.autocompleteStartPoint.input = ''">
                    <ion-icon name="close"></ion-icon>
                </ion-button>
            </ion-buttons>
            <ion-buttons slot="end">
                <ion-button (click)="this.navigationService.getInput(this.navigationService.autocompleteStartPoint); this.navigationService.autocompleteStartPoint.input = 'Mein Standort';
                                 this.navigationService.autocompleteItems = []" class="location-button">
                    <ion-icon name="md-locate"></ion-icon>
                </ion-button>
            </ion-buttons>
        </ion-toolbar>
        <ion-fab>
            <ion-list class="place-list" *ngIf="this.navigationService.showItemsStartPoint"
                      [hidden]="this.navigationService.autocompleteStartPoint.input < 1" no-padding>
                <ion-item *ngFor="let item of this.navigationService.autocompleteItems" tappable
                          (click)="this.navigationService.selectSearchResult(item, this.navigationService.autocompleteStartPoint)">
                    {{ item.description }}
                </ion-item>
            </ion-list>
        </ion-fab>
        <div formArrayName="way_point">
            <div *ngFor="let waypointInstance of this.navigationService.wayPointArray.controls; let i = index"
                 [formGroupName]="i">
                <ion-toolbar class="search">
                    <ion-icon slot="start" name="more"></ion-icon>
                    <ion-input type="text" [(ngModel)]="waypointInstance['input']"
                               (ionInput)="this.navigationService.updateSearchResults(waypointInstance)"
                               (ionFocus)="this.navigationService.showItemsStartPoint = false;
                               this.navigationService.showItemsWayPoint = true;
                               this.navigationService.showItemsEndPoint = false;
                               this.navigationService.showItemsPlaceSearch = false;
                               this.navigationService.autocompleteItems = [];
                               saveWayPoint = waypointInstance;
                               saveWayPointIndex = i;"
                               placeholder="Zwischenstopp" formControlName="way_point_address"></ion-input>
                    <ion-buttons slot="end">
                        <ion-button (click)="this.navigationService.removeWaypoint(i)">
                            <ion-icon name="close"></ion-icon>
                        </ion-button>
                    </ion-buttons>
                </ion-toolbar>
            </div>
            <ion-fab>
                <ion-list class="place-list" *ngIf="this.navigationService.showItemsWayPoint === true"
                          [hidden]="saveWayPoint['input'] < 1" no-padding>
                    <ion-item *ngFor="let item of this.navigationService.autocompleteItems" tappable
                              (click)="this.navigationService.selectSearchResult(item, saveWayPoint)">
                        {{ item.description }}
                    </ion-item>
                </ion-list>
            </ion-fab>
        </div>

        <ion-toolbar class="search">
            <ion-icon slot="start" name="pin"></ion-icon>
            <ion-input type="text" [(ngModel)]="this.navigationService.autocompleteEndPoint.input"
                       (ionInput)="this.navigationService.updateSearchResults(this.navigationService.autocompleteEndPoint)"
                       (ionFocus)="this.navigationService.showItemsStartPoint = false;
                               this.navigationService.showItemsWayPoint = false;
                               this.navigationService.showItemsEndPoint = true;
                               this.navigationService.showItemsPlaceSearch = false;
                               this.navigationService.autocompleteItems = [];"
                       placeholder="Endpunkt" formControlName="end_point"></ion-input>
            <ion-buttons slot="end" [hidden]="this.navigationService.autocompleteEndPoint.input < 1">
                <ion-button (click)="this.navigationService.autocompleteEndPoint.input = ''">
                    <ion-icon name="close"></ion-icon>
                </ion-button>
            </ion-buttons>
        </ion-toolbar>
        <ion-fab>
            <ion-list class="place-list" *ngIf="this.navigationService.showItemsEndPoint"
                      [hidden]="this.navigationService.autocompleteEndPoint.input < 1" no-padding>
                <ion-item *ngFor="let item of this.navigationService.autocompleteItems" tappable
                          (click)="this.navigationService.selectSearchResult(item, this.navigationService.autocompleteEndPoint);">
                    {{ item.description }}
                </ion-item>
            </ion-list>
        </ion-fab>

        <div class="waypt-button">
            <ion-button slot="start" size="small" shape="round" color="primary" fill="clear"
                        (click)="this.navigationService.addWaypoints()">
                <ion-icon slot="start" name="add-circle-outline"></ion-icon>
                Zwischenstopp
            </ion-button>
        </div>
        <div class="info-button"
             [hidden]="this.navigationService.showInfoButton != false">
            <ion-button slot="start" size="small" shape="round" color="primary" fill="clear"
                        (click)="this.navigationService.showInfoButton = true;">
                <ion-icon slot="start" name="information-circle-outline"></ion-icon>
                Informationen hinzufügen
            </ion-button>
        </div>

        <ion-list *ngIf="this.navigationService.showInfoButton"
                  [hidden]="this.navigationService.showInfoButton != true">
            <ion-item class="car-information-title" lines="none">
                <ion-label>Informationen hinzufügen</ion-label>
            </ion-item>
            <div class="car-information">
                <ion-item *ngIf="this.navigationService.reach != ''">
                    <ion-input formControlName="reach" type="number" value="{{this.navigationService.reach}}"></ion-input>
                </ion-item>
                <ion-item *ngIf="this.navigationService.reach == ''">
                    <ion-input formControlName="reach" type="number" placeholder="aktuelle Reichweite in km"></ion-input>
                </ion-item>
                <ion-item>
                    <ion-label>Fahrstil</ion-label>
                    <ion-select formControlName="driving_style" interface="alert" cancelText="Abbrechen"
                                value="{{this.navigationService.driving_style}}">
                        <ion-select-option value="slow">Vorausschauend</ion-select-option>
                        <ion-select-option value="normal">Normal</ion-select-option>
                        <ion-select-option value="fast">Sportlich</ion-select-option>
                    </ion-select>
                </ion-item>
                <ion-item>
                    <ion-label>Temperatur</ion-label>
                    <ion-select formControlName="temperature" interface="alert" cancelText="Abbrechen"
                                value="{{this.navigationService.temperature}}">
                        <ion-select-option value="cold"><10°C</ion-select-option>
                        <ion-select-option value="normal">10°-40°C</ion-select-option>
                        <ion-select-option value="heat">>40°C</ion-select-option>
                    </ion-select>
                </ion-item>
                <ion-item>Steckertypen
                        <ion-button [hidden]="this.navigationService.showPlugTypes != false"
                                    slot="end" size="small" fill="clear"
                                    (click)="this.navigationService.addPlugType();
                                            this.navigationService.showPlugTypes = true;">
                            <ion-icon name="arrow-dropdown"></ion-icon>
                        </ion-button>
                        <ion-button *ngIf="this.navigationService.showPlugTypes"
                                    [hidden]="this.navigationService.showPlugTypes != true"
                                slot="end" size="small" fill="clear"
                                    (click)="this.navigationService.showPlugTypes = false;">
                            <ion-icon name="arrow-dropup"></ion-icon>
                        </ion-button>
                </ion-item>
                <div formArrayName="plug_types"
                     *ngIf="this.navigationService.showPlugTypes"
                     [hidden]="this.navigationService.showPlugTypes != true">
                    <div *ngFor="let plugtypeInstance of this.navigationService.plugTypeArray.controls; let i = index"
                         [formGroupName]="i">
                        <ion-list>
                        <ion-item>
                               <ion-label>AC Schuko</ion-label>
                               <img class="item-checkbox-img" src="../../../assets/icon/schuko.png">
                                <ion-checkbox slot="start" value="schuko"
                                              formControlName = "schuko"
                                (ionFocus)="savePlugType = plugtypeInstance;
                                            savePlugTypeIndex = i;"></ion-checkbox>
                        </ion-item>
                        <ion-item>
                               <ion-label>AC CEE 3 polig</ion-label>
                               <img class="item-checkbox-img" src="../../../assets/icon/cee_blue.png">
                                <ion-checkbox slot="start" value="cee3"
                                              formControlName = "cee3"
                                (ionFocus)="savePlugType = plugtypeInstance;
                                            savePlugTypeIndex = i;"></ion-checkbox>
                        </ion-item>
                        <ion-item>
                               <ion-label>AC CEE 5 polig</ion-label>
                               <img class="item-checkbox-img" src="../../../assets/icon/cee_red.png">
                                <ion-checkbox slot="start" value="cee5"
                                              formControlName = "cee5"></ion-checkbox>
                        </ion-item>
                        <ion-item>
                               <ion-label>AC Kupplung Typ 2</ion-label>
                               <img class="item-checkbox-img" src="../../../assets/icon/type2.png">
                                <ion-checkbox slot="start" value="kupplung2"
                                              formControlName = "kupplung2"></ion-checkbox>
                        </ion-item>
                        <ion-item>
                               <ion-label>AC Steckdose Typ 2</ion-label>
                               <img class="item-checkbox-img" src="../../../assets/icon/type2.png">
                                <ion-checkbox slot="start" value="type2"
                                              formControlName = "type2"></ion-checkbox>
                        </ion-item>
                        <ion-item>
                               <ion-label>DC CHAdeMO</ion-label>
                               <img class="item-checkbox-img" src="../../../assets/icon/chademo.png">
                                <ion-checkbox slot="start" value="chademo"
                                              formControlName = "chademo"></ion-checkbox>
                        </ion-item>
                        <ion-item>
                               <ion-label>DC Kupplung Combo</ion-label>
                               <img class="item-checkbox-img" src="../../../assets/icon/ccs.png">
                                <ion-checkbox slot="start" value="ccs"
                                              formControlName = "ccs"></ion-checkbox>
                        </ion-item>
                        <ion-item>
                               <ion-label>Steckdose Typ 1</ion-label>
                               <img class="item-checkbox-img" src="../../../assets/icon/type1.png">
                                <ion-checkbox slot="start" value="type1"
                                              formControlName = "type1"></ion-checkbox>
                        </ion-item>
                        </ion-list>
                    </div>
                </div>
                <ion-item *ngIf="this.navigationService.station_type != false">
                    <ion-label>nur Schnellladestationen</ion-label>
                    <ion-toggle formControlName="station_type" checked></ion-toggle>
                </ion-item>
                <ion-item *ngIf="this.navigationService.station_type == false">
                    <ion-label>nur Schnellladestationen</ion-label>
                    <ion-toggle formControlName="station_type"></ion-toggle>
                </ion-item>
            </div>
        </ion-list>


        <div class="start-button" text-center>
            <ion-button
                    [disabled]="!this.navigationService.routeForm.valid"
                    slot="end" shape="round" color="primary" fill="outline"
                    (click)="this.navigationService.convertObj(this.navigationService.routeForm.value['start_point'],
                         this.navigationService.routeForm.value['end_point'],
                         this.navigationService.routeForm.value['way_point']);
                         this.navigationService.saveUserData(this.navigationService.routeForm.value['reach'],
                         this.navigationService.routeForm.value['driving_style'],
                         this.navigationService.routeForm.value['temperature'],
                         this.navigationService.routeForm.value['plug_types'],
                         this.navigationService.routeForm.value['station_type']);
                         this.navigationService.showInfoButton = false;">
                <ion-icon slot="start" name="car"></ion-icon>
                Route berechnen
            </ion-button>
        </div>
    </ion-list>
</ion-content>
